<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>28天稳健版英语沟通达标训练营 | English Bootcamp (Work-Ready)</title>
  <style>
    /* -----------------------------
       Simple, clean UI for checklist
       代码（HTML/CSS/JS）使用英文；页面显示中文为主
    ------------------------------ */
    :root {
      --bg: #0f172a;
      --bg-soft: #111827;
      --card: #0b1220;
      --accent: #60a5fa;
      --accent-2: #34d399;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f87171;
      --warning: #fbbf24;
      --ok: #86efac;
      --border: #243045;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: linear-gradient(180deg, #0f172a 0%, #0b1220 100%);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Helvetica Neue", Arial, "PingFang SC", "Microsoft Yahei", sans-serif;
      line-height: 1.55;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: saturate(140%) blur(10px);
      border-bottom: 1px solid var(--border);
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 20px;
    }
    .title {
      display: flex;
      align-items: baseline;
      gap: 12px;
    }
    .title h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: .2px;
    }
    .title .sub { color: var(--muted); font-size: 13px; }
    .toolbar {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .btn {
      background: #0a1221;
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 13px;
      cursor: pointer;
      transition: all .18s ease;
    }
    .btn:hover { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(96,165,250,.15) inset; }
    .btn.primary { background: linear-gradient(180deg, #1d4ed8, #1e40af); border-color: #264c9f; }
    .btn.success { background: linear-gradient(180deg, #059669, #047857); border-color: #0e7e66; }
    .btn.warn { background: linear-gradient(180deg, #ca8a04, #a16207); border-color: #92600d; }
    .meta {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
      margin: 16px 0 22px 0;
    }
    .card {
      grid-column: span 12;
      background: linear-gradient(180deg, #0b1220, #0a0f1a);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .card h3 { margin: 0 0 8px 0; font-size: 15px; }
    .card p { margin: 4px 0; color: var(--muted); font-size: 13px; }
    .grid-days { display: grid; gap: 14px; }
    .day {
      background: linear-gradient(180deg, #0b1220, #0a0f1a);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
    }
    .day-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: radial-gradient(1200px 200px at 0% -10%, rgba(96,165,250,.12), transparent), radial-gradient(1200px 200px at 100% 120%, rgba(52,211,153,.10), transparent);
    }
    .day-title { font-size: 15px; font-weight: 700; letter-spacing: .2px; }
    .day-sub { color: var(--muted); font-size: 12px; }
    .day-actions { display: flex; gap: 8px; }
    .day-body { display: none; padding: 8px 12px 14px 12px; }
    .day.open .day-body { display: block; }
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td {
      border-bottom: 1px dashed var(--border);
      padding: 10px 8px;
      vertical-align: top;
      font-size: 13px;
    }
    .table th { text-align: left; color: var(--muted); font-weight: 600; }
    .time { white-space: nowrap; color: #cbd5e1; }
    .task-title { font-weight: 700; color: #e2e8f0; }
    .res, .method, .done, .review { color: var(--muted); }
    .kpi { color: #d1fae5; }
    .break { color: #93c5fd; font-weight: 600; }
    .checkbox { transform: translateY(2px); }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 11px; border: 1px solid var(--border); color: #cbd5e1; }
    .badge.accent { border-color: rgba(96,165,250,.4); color: #bfdbfe; }
    .badge.green { border-color: rgba(52,211,153,.4); color: #bbf7d0; }
    .badge.yellow { border-color: rgba(251,191,36,.4); color: #fde68a; }
    .badge.pink { border-color: rgba(244,114,182,.4); color: #fbcfe8; }
    .kbd { background: #0a1325; border: 1px solid var(--border); padding: 1px 6px; border-radius: 6px; font-size: 11px; color: #cbd5e1; }
    .foot {
      color: var(--muted);
      font-size: 12px;
      margin-top: 24px;
      padding-bottom: 80px;
    }
    .sticky-cta {
      position: fixed;
      right: 16px;
      bottom: 16px;
      display: flex;
      gap: 8px;
      z-index: 30;
    }
    /* Progress bar */
    .progress-wrap { display: flex; align-items: center; gap: 10px; }
    .progress-text { font-size: 12px; color: var(--muted); }
    .progress-bar {
      position: relative;
      width: 180px;
      height: 8px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: #0a1325;
      overflow: hidden;
    }
    .progress-bar > span {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background: linear-gradient(90deg, #34d399, #10b981);
      width: 0%;
      transition: width .2s ease;
    }
    /* Mini buttons */
    .btn.mini { padding: 4px 8px; font-size: 12px; border-radius: 8px; }
    .btn.ghost { background: transparent; }
    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.5);
      backdrop-filter: blur(2px);
      display: none;
      z-index: 40;
    }
    .modal {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: min(980px, 92vw);
      max-height: 80vh;
      overflow: auto;
      background: #0b1220;
      border: 1px solid var(--border);
      border-radius: 14px;
      display: none;
      z-index: 41;
      box-shadow: 0 20px 80px rgba(0,0,0,.45);
    }
    .modal.open, .modal-backdrop.open { display: block; }
    .modal header { position: sticky; top: 0; background: #0b1220; border-bottom: 1px solid var(--border); }
    .modal .body { padding: 14px; }
    .template {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      background: #0a0f1a;
    }
    .template h4 { margin: 4px 0 8px 0; font-size: 14px; }
    .template pre { white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; color: #d1d5db; background: #0a1325; border: 1px solid var(--border); border-radius: 8px; padding: 10px; }
    a { color: #93c5fd; text-decoration: none; }
    a:hover { text-decoration: underline; }
    @media (min-width: 900px) {
      .cards { grid-template-columns: repeat(12, 1fr); }
      .card--third { grid-column: span 4; }
      .card--half { grid-column: span 6; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="title">
        <h1>28天稳健版英语沟通达标训练营</h1>
        <span class="sub">把你的英语用起来·透析法 × 费曼学习法 × 艾宾浩斯复习 · ELSA口语 · Upwork/Fiverr实战</span>
      </div>
      <div class="toolbar">
        <button class="btn primary" id="expandAll">展开全部天</button>
        <button class="btn" id="collapseAll">折叠全部天</button>
        <button class="btn" id="clearChecks">清除所有勾选</button>
        <button class="btn success" id="exportProgress">导出进度JSON</button>
        <button class="btn warn" id="printPlan">打印/导出PDF</button>
        <button class="btn" id="openTemplates">模板/范例库</button>
        <button class="btn" id="openExport">今日导出（MD/JSON）</button>
      </div>
      <div class="meta">
        <div>每日时间：08:30–22:00（午餐 12:00–13:30｜晚餐 18:00–19:30）</div>
        <div>目标：达到“工作沟通最低可用线”（提案/纪要/里程碑/验收/15分钟会议）</div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="cards">
      <article class="card card--half">
        <h3>使用说明</h3>
        <p>每个时间段都含：参考资料、学习方法、完成标准、复习策略。勾选任务会自动保存到本地（LocalStorage）。</p>
        <p>复习遵循艾宾浩斯：D+1、D+3、D+7、D+14、D+28，页面在固定时段安排复习位。</p>
      </article>
      <article class="card card--half">
        <h3>核心资料（官方为准）</h3>
        <p>
          书籍：
          <a href="https://www.cambridge.org/gb/cambridgeenglish/catalog/grammar-vocabulary-and-pronunciation/english-grammar-use-5th-edition" target="_blank" rel="noopener">English Grammar in Use 5th（Cambridge）</a>、
          <a href="https://www.oxfordlearnersdictionaries.com/definition/english/practical-english-usage" target="_blank" rel="noopener">Practical English Usage（Swan）</a>、
          把你的英语用起来（“透析法”）
        </p>
        <p>
          工具：
          <a href="https://elsaspeak.com/" target="_blank" rel="noopener">ELSA Speak</a>、
          <a href="https://youglish.com/" target="_blank" rel="noopener">YouGlish</a>、
          <a href="https://www.grammarly.com/" target="_blank" rel="noopener">Grammarly</a>、
          <a href="https://www.deepl.com/" target="_blank" rel="noopener">DeepL</a>、
          <a href="https://www.loom.com/" target="_blank" rel="noopener">Loom</a>、
          <a href="https://www.notion.so/" target="_blank" rel="noopener">Notion</a>、
          <a href="https://www.bbc.co.uk/learningenglish/english/features/6-minute-english" target="_blank" rel="noopener">BBC 6 Minute English</a>、
          <a href="https://www.businessenglishpod.com/" target="_blank" rel="noopener">Business English Pod</a>、
          <a href="https://learnenglish.britishcouncil.org/" target="_blank" rel="noopener">British Council LearnEnglish</a>
        </p>
        <p>
          职场英语频道：
          <a href="https://www.youtube.com/@BusinessEnglishPod" target="_blank" rel="noopener">BEP（YouTube）</a>、
          <a href="https://www.youtube.com/@OxfordOnlineEnglish" target="_blank" rel="noopener">Oxford Online English（YouTube）</a>、
          <a href="https://www.youtube.com/@LearnEnglishwithCambridge" target="_blank" rel="noopener">Learn English with Cambridge（YouTube）</a>、
          <a href="https://www.youtube.com/@bbclearningenglish" target="_blank" rel="noopener">BBC Learning English（YouTube）</a>、
          <a href="https://www.engvid.com/english/business-english/" target="_blank" rel="noopener">engVid Business English</a>
        </p>
      </article>
      <article class="card card--third">
        <h3>每日KPI</h3>
        <p class="kpi">口语≥30分钟、写作≥45分钟、透析≥60–90分钟、复习≥30分钟、实战≥60分钟</p>
      </article>
      <article class="card card--third">
        <h3>行为原则</h3>
        <p>短句表达、要点先行、先复述后确认、每次学习产出可交付物（录音/文档/要点表）。</p>
      </article>
      <article class="card card--third">
        <h3>周节奏</h3>
        <p>第1周打基础｜第2周强输出｜第3周实战模拟｜第4周巩固与上麦。</p>
      </article>
    </section>

    <div id="days" class="grid-days"></div>

    <section class="foot">
      <p>提示：所有资源以官网更新为准；如遇不可用资源，使用等价替代搜索关键词（如“YouGlish + 关键短语”）。</p>
    </section>
  </main>

  <div class="sticky-cta">
    <button class="btn" id="jumpTop">回到顶部</button>
    <button class="btn" id="jumpToday">跳到今天</button>
  </div>
  
  <!-- Templates Modal -->
  <div class="modal-backdrop" id="tplBackdrop"></div>
  <div class="modal" id="tplModal">
    <header class="container" style="padding:10px 14px; display:flex; justify-content:space-between; align-items:center;">
      <div style="font-weight:700; font-size:14px;">模板/范例库（可复制）</div>
      <div style="display:flex; gap:8px;">
        <button class="btn mini" id="closeTemplates">关闭</button>
      </div>
    </header>
    <div class="body">
      <div class="template">
        <h4>Upwork Proposal Opening</h4>
        <button class="btn mini" data-copy="tpl-proposal">复制</button>
        <pre id="tpl-proposal">Subject: Ship your MVP faster with a small, testable milestone first

Hi {ClientName},

I’ve built {similar outcomes} for {industries/clients}. For your {project}, I suggest:
1) 3-day discovery + clickable prototype to de-risk scope
2) 1–2 weeks delivery with weekly demos and clear acceptance tests

Deliverables: repo, docs, test records, and a short demo video.
Happy to start with a paid mini-milestone to prove fit.

Best, {YourName}</pre>
      </div>
      <div class="template">
        <h4>30-min Discovery Agenda</h4>
        <button class="btn mini" data-copy="tpl-agenda">复制</button>
        <pre id="tpl-agenda">- Goals & users (5’)
- Must-haves vs nice-to-haves (10’)
- Constraints & risks (5’)
- Milestones, timeline, budget (5’)
- Next steps & responsibilities (5’)</pre>
      </div>
      <div class="template">
        <h4>Meeting Summary Email</h4>
        <button class="btn mini" data-copy="tpl-summary">复制</button>
        <pre id="tpl-summary">Subject: Summary & next steps — {Project}

Hi {Name},

Summary:
- Goals:
- Scope (in/out of scope):
- Acceptance criteria:
- Risks/assumptions:

Next steps:
- I will {deliverable} by {date}
- You will provide {access/asset} by {date}

Please reply “approved” or share edits. I’ll proceed with the first milestone in escrow.
Best,
{YourName}</pre>
      </div>
      <div class="template">
        <h4>Change Request</h4>
        <button class="btn mini" data-copy="tpl-change">复制</button>
        <pre id="tpl-change">Thanks for the new request. It’s outside the current scope ({reason}).
Options:
A) Swap with an existing item (no cost change)
B) Add a new milestone: {deliverable}, {days}, ${price}

Which do you prefer? I’ll update the SOW.</pre>
      </div>
      <div class="template">
        <h4>Acceptance & Release</h4>
        <button class="btn mini" data-copy="tpl-accept">复制</button>
        <pre id="tpl-accept">Milestone deliverables:
- Demo link
- Test results
- Docs / handover

If this meets the acceptance criteria, please release escrow. Ready for the next milestone.</pre>
      </div>
    </div>
  </div>
  
  <!-- Export Today Modal -->
  <div class="modal-backdrop" id="expBackdrop"></div>
  <div class="modal" id="expModal">
    <header class="container" style="padding:10px 14px; display:flex; justify-content:space-between; align-items:center;">
      <div style="font-weight:700; font-size:14px;">今日打卡导出</div>
      <div style="display:flex; gap:8px;">
        <button class="btn mini" id="copyMD">复制Markdown</button>
        <button class="btn mini" id="copyJSON">复制JSON</button>
        <button class="btn mini" id="closeExport">关闭</button>
      </div>
    </header>
    <div class="body">
      <div class="template">
        <h4>导出预览（Markdown）</h4>
        <pre id="export-md"></pre>
      </div>
      <div class="template">
        <h4>导出预览（JSON）</h4>
        <pre id="export-json"></pre>
      </div>
      <p class="res">提示：复制Markdown后，在Notion中新建页面，直接粘贴即可自动识别标题/清单/链接；或在现有页面中粘贴，选择“Merge with existing content”。</p>
    </div>
  </div>

  <script>
    // -----------------------------
    // Data & generators (English code, Chinese UI text)
    // -----------------------------
    const LUNCH = { start: "12:00", end: "13:30" };
    const DINNER = { start: "18:00", end: "19:30" };

    const grammarTopics = [
      "时态总览：一般现在/现在进行，用于陈述与安排",
      "一般过去 vs 现在完成：经历与结果",
      "将来表达：will / going to / present continuous",
      "情态动词：请求、建议、义务（can/could/should/must）",
      "条件句：零/第一条件句（真实条件）",
      "条件句：第二/第三条件句（虚拟与假设）",
      "被动语态：客观表达与报告",
      "冠词与限定词：a/an/the/this/that/any/some",
      "可数与不可数名词：数量表达与搭配",
      "介词：时间与地点（at/in/on/by/during/within）",
      "关系从句：定义/非定义，减少冗余",
      "分词与简化从句：书面表达提效",
      "动名词与不定式：计划/建议/偏好表达",
      "间接引语：转述会议与需求",
      "疑问句型：开放式/封闭式/反意疑问",
      "语序与强调：清晰表达重点",
      "标点与风格：商务邮件最佳实践",
      "连接词：因果/转折/递进/让步",
      "商务搭配：scope/milestone/acceptance/escrow",
      "常用动词短语：follow up, figure out, point out",
      "邮件语气与语态：礼貌而明确",
      "验收标准语言：清单化表达",
      "SOW与范围管理：in scope / out of scope",
      "风险与假设：assumption/constraint/risk",
      "谈判与澄清：trade-off / option / proposal",
      "反馈与修订：iteration/revision/change request",
      "会议推进：议程/控场/总结",
      "综合回顾与自测：薄弱点查缺补漏"
    ];

    // Curated resource pools with authoritative links (rotated by day)
    const curated = {
      listeningShort: [
        { name: 'BBC 6 Minute English – Playlist', url: 'https://www.bbc.co.uk/learningenglish/english/features/6-minute-english' },
        { name: 'BBC English at Work – Series', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work' },
        { name: 'VOA Learning English – Everyday Grammar TV', url: 'https://learningenglish.voanews.com/z/952' }
      ],
      businessListening: [
        { name: 'Business English Pod – Meetings', url: 'https://www.businessenglishpod.com/category/meetings-english/' },
        { name: 'Business English Pod – Telephoning', url: 'https://www.businessenglishpod.com/category/telephoning/' },
        { name: 'Business English Pod – Presentations', url: 'https://www.businessenglishpod.com/category/presentations/' }
      ],
      workYtChannels: [
        { name: 'BEP – YouTube', url: 'https://www.youtube.com/@BusinessEnglishPod' },
        { name: 'Oxford Online English – Business Playlists', url: 'https://www.youtube.com/@OxfordOnlineEnglish' },
        { name: 'Learn English with Cambridge – Workplace', url: 'https://www.youtube.com/@LearnEnglishwithCambridge' },
        { name: 'BBC Learning English – Channel', url: 'https://www.youtube.com/@bbclearningenglish' },
        { name: 'engVid – Business English', url: 'https://www.engvid.com/english/business-english/' }
      ],
      grammarRef: [
        { name: 'Perfect English Grammar – Tenses Overview', url: 'https://www.perfect-english-grammar.com/verb-tenses.html' },
        { name: 'British Council – Grammar Reference', url: 'https://learnenglish.britishcouncil.org/grammar' },
        { name: 'Cambridge Dictionary – Grammar', url: 'https://dictionary.cambridge.org/grammar' }
      ],
      emailWriting: [
        { name: 'British Council – Emails: Structure & Style', url: 'https://learnenglish.britishcouncil.org/skills/writing/b1-writing/an-email-to-a-friend' },
        { name: 'Purdue OWL – Professional Email Etiquette', url: 'https://owl.purdue.edu/owl/subject_specific_writing/professional_technical_writing/email_etiquette.html' },
        { name: 'Coursera – Write Professional Emails (Georgia Tech)', url: 'https://www.coursera.org/learn/professional-emails-english' }
      ],
      negotiationCrossCulture: [
        { name: 'BEP – Negotiations', url: 'https://www.businessenglishpod.com/category/negotiations/' },
        { name: 'Oxford Online English – Business Negotiations', url: 'https://www.youtube.com/@OxfordOnlineEnglish' },
        { name: 'British Council – Working across cultures', url: 'https://learnenglish.britishcouncil.org/skills/listening/b2-listening/working-across-cultures' }
      ],
      proposalGuides: [
        { name: 'Upwork Academy – Proposals', url: 'https://academy.upwork.com/path/proposals' },
        { name: 'Upwork Help – Create a Proposal', url: 'https://support.upwork.com/hc/en-us/articles/211063468-Create-a-Proposal' },
        { name: 'Fiverr Help – Gig Title & Description', url: 'https://help.fiverr.com/hc/en-us/articles/360011029078-Create-a-Gig' }
      ],
      readingTech: [
        { name: 'Smashing Magazine – Web Dev Articles', url: 'https://www.smashingmagazine.com/articles/' },
        { name: 'MDN Web Docs – Guides', url: 'https://developer.mozilla.org/en-US/docs/Learn' },
        { name: 'OpenAI Dev Blog (technical English sample)', url: 'https://openai.com/blog' }
      ],
      phraseSearch: [
        { name: 'YouGlish – acceptance criteria', url: 'https://youglish.com/pronounce/acceptance%20criteria/english' },
        { name: 'YouGlish – scope of work', url: 'https://youglish.com/pronounce/scope%20of%20work/english' },
        { name: 'YouGlish – change request', url: 'https://youglish.com/pronounce/change%20request/english' }
      ]
    };

    // Per-day fixed mapping (precise episodes/articles) without breaking structure
    // Provide concrete picks; when absent, fallback to curated rotation.
    const fixedMap = {
      listeningShort: [
        // Day 1..28 (examples start; extend or repeat as needed)
        { name: 'English at Work – Episode 1', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-1' },
        { name: 'English at Work – Episode 2', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-2' },
        { name: 'English at Work – Episode 3', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-3' },
        { name: 'English at Work – Episode 4', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-4' },
        { name: 'English at Work – Episode 5', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-5' },
        { name: 'English at Work – Episode 6', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-6' },
        { name: 'English at Work – Episode 7', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-7' },
        { name: 'English at Work – Episode 8', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-8' },
        { name: 'English at Work – Episode 9', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-9' },
        { name: 'English at Work – Episode 10', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-10' },
        { name: 'English at Work – Episode 11', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-11' },
        { name: 'English at Work – Episode 12', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-12' },
        { name: 'English at Work – Episode 13', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-13' },
        { name: 'English at Work – Episode 14', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-14' },
        { name: 'English at Work – Episode 15', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-15' },
        { name: 'English at Work – Episode 16', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-16' },
        { name: 'English at Work – Episode 17', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-17' },
        { name: 'English at Work – Episode 18', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-18' },
        { name: 'English at Work – Episode 19', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-19' },
        { name: 'English at Work – Episode 20', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-20' },
        { name: 'English at Work – Episode 21', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-21' },
        { name: 'English at Work – Episode 22', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-22' },
        { name: 'English at Work – Episode 23', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-23' },
        { name: 'English at Work – Episode 24', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-24' },
        { name: 'English at Work – Episode 25', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-25' },
        { name: 'English at Work – Episode 26', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-26' },
        { name: 'English at Work – Episode 27', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-27' },
        { name: 'English at Work – Episode 28', url: 'https://www.bbc.co.uk/learningenglish/english/features/english-at-work/ep-28' }
      ],
      businessListening: [
        { name: 'BEP – Meetings (1)', url: 'https://www.businessenglishpod.com/2007/01/07/bep-20-english-meetings-introductions-greetings-small-talk/' },
        { name: 'BEP – Meetings (2)', url: 'https://www.businessenglishpod.com/2007/01/21/bep-21-english-meetings-making-suggestions/' },
        { name: 'BEP – Meetings (3)', url: 'https://www.businessenglishpod.com/2007/02/04/bep-22-english-meetings-agreeing-and-disagreeing/' },
        { name: 'BEP – Meetings (4)', url: 'https://www.businessenglishpod.com/2007/02/18/bep-23-english-meetings-making-decisions/' },
        { name: 'BEP – Telephoning (1)', url: 'https://www.businessenglishpod.com/2007/03/04/bep-24-english-telephoning-introductions-and-requests/' },
        { name: 'BEP – Telephoning (2)', url: 'https://www.businessenglishpod.com/2007/03/18/bep-25-english-telephoning-leaving-and-taking-messages/' },
        { name: 'BEP – Telephoning (3)', url: 'https://www.businessenglishpod.com/2007/04/01/bep-26-english-telephoning-with-the-customer-service-department/' },
        { name: 'BEP – Presentations (1)', url: 'https://www.businessenglishpod.com/2007/04/15/bep-27-english-presentations-introductions/' },
        { name: 'BEP – Presentations (2)', url: 'https://www.businessenglishpod.com/2007/04/29/bep-28-english-presentations-overview-and-structure/' },
        { name: 'BEP – Presentations (3)', url: 'https://www.businessenglishpod.com/2007/05/13/bep-29-english-presentations-signalling-transitions/' },
        { name: 'BEP – Negotiations (1)', url: 'https://www.businessenglishpod.com/2007/05/27/bep-30-english-negotiations-making-proposals/' },
        { name: 'BEP – Negotiations (2)', url: 'https://www.businessenglishpod.com/2007/06/10/bep-31-english-negotiations-bargaining/' },
        { name: 'BEP – Negotiations (3)', url: 'https://www.businessenglishpod.com/2007/06/24/bep-32-english-negotiations-reaching-agreement/' },
        { name: 'BEP – Telephoning (4)', url: 'https://www.businessenglishpod.com/2007/07/08/bep-33-english-telephoning-appointments-and-schedules/' },
        { name: 'BEP – Telephoning (5)', url: 'https://www.businessenglishpod.com/2007/07/22/bep-34-english-telephoning-confirming-and-checking-information/' },
        { name: 'BEP – Presentations (4)', url: 'https://www.businessenglishpod.com/2007/08/05/bep-35-english-presentations-describing-graphs-and-trends/' },
        { name: 'BEP – Meetings (5)', url: 'https://www.businessenglishpod.com/2007/08/19/bep-36-english-meetings-reviewing-progress/' },
        { name: 'BEP – Meetings (6)', url: 'https://www.businessenglishpod.com/2007/09/02/bep-37-english-meetings-reporting-and-summarizing/' },
        { name: 'BEP – Meetings (7)', url: 'https://www.businessenglishpod.com/2007/09/16/bep-38-english-meetings-clarifying-and-clarification/' },
        { name: 'BEP – Meetings (8)', url: 'https://www.businessenglishpod.com/2007/09/30/bep-39-english-meetings-finishing-up-and-action-points/' },
        { name: 'BEP – Presentations (5)', url: 'https://www.businessenglishpod.com/2007/10/14/bep-40-english-presentations-describing-company-performance/' },
        { name: 'BEP – Telephoning (6)', url: 'https://www.businessenglishpod.com/2007/10/28/bep-41-english-telephoning-connecting-calls-and-taking-messages/' },
        { name: 'BEP – Negotiations (4)', url: 'https://www.businessenglishpod.com/2007/11/11/bep-42-english-negotiations-bargaining-and-deadlines/' },
        { name: 'BEP – Negotiations (5)', url: 'https://www.businessenglishpod.com/2007/11/25/bep-43-english-negotiations-offers-and-counter-offers/' },
        { name: 'BEP – Meetings (9)', url: 'https://www.businessenglishpod.com/2007/12/09/bep-44-english-meetings-following-up/' },
        { name: 'BEP – Presentations (6)', url: 'https://www.businessenglishpod.com/2007/12/23/bep-45-english-presentations-concluding-and-q-and-a/' },
        { name: 'BEP – Telephoning (7)', url: 'https://www.businessenglishpod.com/2008/01/06/bep-46-english-telephoning-taking-and-leaving-a-message/' },
        { name: 'BEP – Presentations (7)', url: 'https://www.businessenglishpod.com/2008/01/20/bep-47-english-presentations-reviewing-graphs-and-tables/' }
      ]
    };

    // Offsets for resource switching per day & slot
    const offsetKey = (d, k) => `eb28:offset:${d}:${k}`;
    function getOffset(d, k) {
      const v = localStorage.getItem(offsetKey(d, k));
      return v ? parseInt(v, 10) || 0 : 0;
    }
    function incOffset(d, k) {
      const cur = getOffset(d, k);
      localStorage.setItem(offsetKey(d, k), String(cur + 1));
    }
    function pick(list, dayOffset = 0, extraOffset = 0) {
      if (!list || list.length === 0) return null;
      const idx = (dayOffset + (extraOffset || 0)) % list.length;
      return list[idx];
    }

    // Slot templates with detailed resources/method/completion/review
    const slotTemplates = {
      srsMorning: (d) => ({
        title: "晨间复习+跟读（艾宾浩斯）",
        resources: [
          '<a href="https://apps.ankiweb.net/" target="_blank" rel="noopener">Anki（SRS）</a>',
          `<a href="${pick(curated.phraseSearch, d-1).url}" target="_blank" rel="noopener">${pick(curated.phraseSearch, d-1).name}</a>`
        ],
        method: "分步执行（共30分钟）\n1) 复习卡片（18分钟）：打开Anki→进入复习→每张卡先回忆答案（不看提示）→再翻面核对→将错误点写到卡片备注。对每张卡按难度打分，确保间隔复习正确触发。\n2) 强化5张难点卡（7分钟）：选择今天最难的5张，做“看提示词→3秒造句→大声朗读→遮住再复述”的循环，每张至少3轮。\n3) 短语发音（5分钟）：打开资源中的短语链接→各短语在YouGlish里找3个例句→逐句跟读（先慢速0.75，再正常1.0），注意重音与连读。",
        done: "满足以下条件即合格：\n- 复习卡片≥20张且完成难度打分；\n- 5张难点卡各完成≥3轮“看→说→复述”；\n- 至少跟读3个短语、每个短语≥3个例句。",
        review: "当日收尾：将新错题加入卡片并打上“today-hard”标签；为新增卡设置D+1/D+3/D+7/D+14/D+28；把3个短语中的1个做成“用你场景造句”的卡片（正面中文/提示，反面英文+音标）。"
      }),
      dialysis: (d) => ({
        title: "透析法输入-输出（文本精读到复写）",
        resources: [
          "《把你的英语用起来》透析法章节",
          '<a href="https://www.cambridge.org/gb/cambridgeenglish/catalog/grammar-vocabulary-and-pronunciation/english-grammar-use-5th-edition" target="_blank" rel="noopener">English Grammar in Use</a>',
          `<a href="${pick(curated.readingTech, d-1).url}" target="_blank" rel="noopener">${pick(curated.readingTech, d-1).name}</a>`
        ],
        method: "分步执行（共90分钟）\n1) 选材预览（5分钟）：打开当日技术/业务文章→快速通读标题、小节、首末句，确认与你方向相关。\n2) 精读标注（20分钟）：逐段阅读，标注“词块/句型/逻辑连接”（颜色区分：蓝=词块，绿=句型，黄=关键逻辑）。难句用DeepL对照，写出“自己的直译与意译”。\n3) 结构提炼（10分钟）：写3–5条中文要点（问题/方案/结果/限制），每条≤15字。\n4) 复述训练（20分钟）：关闭原文→用简单英文写150–200词复述，只保留核心信息与关键词块。\n5) 场景改写（25分钟）：将复述转化为“提案/纪要/需求澄清”之一：加入里程碑/验收句子（按模板），保持150–220词。\n6) 口述总结（10分钟）：打开录音→用30–60秒讲明该文的“问题-方案-指标”，尝试3遍，保留最佳一版。",
        done: "合格标准：\n- 标注稿包含：≥8个词块、≥3个句型、≥3个逻辑连接示例；\n- 英文复述150–200词，主题清楚、无机翻痕迹；\n- 场景改写产出：含明确里程碑与验收点至少2条；\n- 1段30–60秒录音，总结清晰。",
        review: "当日：把词块/句型中“最想用”的10条做成SRS卡（正面=提示/中文，反面=英文+你造的例句）。\nD+1：复述稿快速复读→改3处表达；D+3：把1条复述转成会议纪要版；D+7：再写一次提案版，对比措辞升级。"
      }),
      grammar: (d) => ({
        title: `语法微课：${grammarTopics[(d-1) % grammarTopics.length]}`,
        resources: [
          `<a href="${pick(curated.grammarRef, d-1).url}" target="_blank" rel="noopener">${pick(curated.grammarRef, d-1).name}</a>`,
          '<a href="https://youglish.com/" target="_blank" rel="noopener">YouGlish 用例</a>'
        ],
        method: "分步执行（共60分钟）\n1) 规则速读（10分钟）：阅读权威页→记录“用法要点/常见错误”各3条。\n2) 控制性练习（15分钟）：针对该语法写5句“模板句”（用你的业务名词替换占位），逐句朗读与微调。\n3) 语境化练习（15分钟）：把5句嵌入“提案/邮件/纪要”微段落（80–120词），保证逻辑通顺。\n4) 口头输出（15分钟）：用该语法讲解你今天的任务（30–60秒）→录音回听并改进词序/连词。\n5) 易错记录（5分钟）：把今天出现≥2次的错误登记到“语法错因表”。",
        done: "合格标准：\n- 模板句≥5句且读顺；\n- 语境段落80–120词，目标语法出现≥3次；\n- 1段30–60秒讲解录音；\n- 错因表新增≥2条并给出修正例句。",
        review: "当日：为该语法制作3张卡（规则/正例/反例）。\nD+3：把原段落替换同义连接词重写一次；D+7：在新邮件或提案中刻意使用该语法≥3次并标注。"
      }),
      listening: (d) => ({
        title: "听力与速记（要点捕捉）",
        resources: [
          (fixedMap.listeningShort[d-1] ? `<a href="${fixedMap.listeningShort[d-1].url}" target="_blank" rel="noopener">${fixedMap.listeningShort[d-1].name}</a>` : `<a href="${pick(curated.listeningShort, d-1, getOffset(d, 'listening')).url}" target="_blank" rel="noopener">${pick(curated.listeningShort, d-1, getOffset(d, 'listening')).name}</a>`) +
          ' ｜ ' +
          `<a href="${pick(curated.workYtChannels, d-1, getOffset(d, 'listening')).url}" target="_blank" rel="noopener">${pick(curated.workYtChannels, d-1, getOffset(d, 'listening')).name}</a>`,
          '<a href="https://youglish.com/" target="_blank" rel="noopener">YouGlish 跟读</a>'
        ],
        method: "分步执行（共30分钟）\n1) 首听（8分钟）：不开字幕，抓“人物/地点/任务/结果”，写4要素各1行。\n2) 精听（10分钟）：每句暂停记关键词；难点回放≤3次；记录3个听不清的搭配并查询。\n3) 复述（7分钟）：不看稿，口述30–45秒总结，强调“问题→行动→结果”。\n4) 跟读（5分钟）：挑6句最地道表达→跟读两遍（0.75x→1.0x），注意重音与连读。",
        done: "合格标准：\n- 要点清单≥5条；\n- 记录≥3个新搭配（含释义）；\n- 30–45秒复述录音1段；\n- 跟读6句完成两遍。",
        review: "当日：把3个新搭配写入SRS并造句。\nD+1：重听同一集，用不同措辞再复述一次；D+7：选择同主题另一集做迁移复述。"
      }),
      lunch: () => ({ title: "午餐休息", resources: [], method: "离屏休息：\n- 5分钟闭目+腹式呼吸；\n- 10分钟走动或拉伸肩颈；\n- 避免信息流刷屏，保护注意力。", done: "完成至少10分钟离屏走动/拉伸，补水。", review: "若上午有难点，午休末尾用2分钟口头复述要点。" }),
      elsa: (d) => ({
        title: "ELSA口语（发音/流利度/商务模块）",
        resources: ['<a href="https://elsaspeak.com/" target="_blank" rel="noopener">ELSA Speak App（每日课程）</a>'],
        method: "分步执行（共60分钟）\n1) 日常课程（25分钟）：完成ELSA今日recommended→记录问题音（如/θ/、/ð/、/r/）。\n2) 针对音训练（10分钟）：进入“sound training”，每个问题音至少完成1套练习并复听。\n3) 句子跟读（10分钟）：选你写作/提案中的6句→逐句录音对比，修正重音与节奏。\n4) 即兴输出（15分钟）：录两段60–90秒“自我介绍/方案说明”，第二段要求更自然更快。",
        done: "合格标准：\n- ELSA得分≥80/100；\n- 问题音清单≥2个并各完成1套练习；\n- 2段60–90秒录音（第二段更流畅）。",
        review: "当日：把2个问题音做成SRS卡（口型要点/对比最小对）。\nD+3：复录同一段并比较波形/节奏；D+7：抽取3句做“连读/弱读”专项跟读。"
      }),
      feynman: (d) => ({
        title: "费曼讲解（以教促学）",
        resources: ['<a href="https://www.loom.com/" target="_blank" rel="noopener">Loom录屏</a>', '<a href="https://www.notion.so/" target="_blank" rel="noopener">Notion讲义模板</a>'],
        method: "分步执行（共60分钟）\n1) 选题与大纲（10分钟）：从今天语法/透析中选1个→写“问题→方案→例子→常错点”的4点提纲。\n2) 草拟讲解（10分钟）：每点写2–3句“通俗表达”，避免专业术语。\n3) 录制第一版（10分钟）：2–3分钟，不看稿，聚焦逻辑清晰。\n4) 复看修订（10分钟）：记录3个表达问题（冗长/模糊/语法），改写为更短句。\n5) 录制第二版（10分钟）：对比第一版更清晰、语速更稳。\n6) 导出要点（10分钟）：把讲解中的“关键句+风险提醒”整理到讲义页。",
        done: "合格标准：\n- 2–3分钟讲解视频1个（第二版更优）；\n- 讲义要点≥5条含“风险/常错点”；\n- 列出3个表达问题与改写句。",
        review: "当日：把2句最通俗解释做成SRS“类比卡”。\nD+3：针对同主题再讲1次；D+7：把该主题写成邮件模板中的段落（100词）。"
      }),
      writing: (d) => ({
        title: "实战写作（提案/邮件/会议纪要）",
        resources: [
          `<a href="${pick(curated.proposalGuides, d-1, getOffset(d, 'writing')).url}" target="_blank" rel="noopener">${pick(curated.proposalGuides, d-1, getOffset(d, 'writing')).name}</a>`,
          '<a href="https://www.grammarly.com/" target="_blank" rel="noopener">Grammarly</a> / <a href="https://www.deepl.com/" target="_blank" rel="noopener">DeepL</a>',
          `<a href="${pick(curated.emailWriting, d-1, getOffset(d, 'writing')).url}" target="_blank" rel="noopener">${pick(curated.emailWriting, d-1, getOffset(d, 'writing')).name}</a>`
        ],
        method: "分步执行（共60分钟）\n1) 选场景（5分钟）：从“澄清/报价/周报/纪要/提案”中选1个目标。\n2) 搭骨架（10分钟）：按照模板列出段落：开场复述→方案要点→里程碑/验收→CTA。\n3) 填内容（20分钟）：每段2–3句，使用今天透析/语法中的词块与句型，避免长难句。\n4) 校对（10分钟）：DeepL润色→Grammarly检查，修正语法/标点/语气。\n5) 终稿与版本（10分钟）：输出150–220词；在末尾附“2个里程碑+每个1条验收动作”。",
        done: "合格标准：\n- 字数150–220词；\n- 包含CTA（预约通话或确认Escrow）；\n- 至少2个里程碑且各有验收动作；\n- Grammarly总体≥90。",
        review: "当日：把2句开场/澄清/收尾中的“功能句”做成SRS卡。\nD+3：同场景改写为另一种语气（更简洁/更礼貌）；D+7：把本周3篇合并为最佳版本。"
      }),
      srsAfternoon: (d) => ({
        title: "SRS卡片构建与复盘",
        resources: ['<a href="https://apps.ankiweb.net/" target="_blank" rel="noopener">Anki</a> / <a href="https://www.notion.so/" target="_blank" rel="noopener">Notion</a>', "今天产出物"],
        method: "分步执行（共30分钟）\n1) 汇总素材（5分钟）：从早/午产出中挑词块/句型/错因。\n2) 做卡（15分钟）：每张卡“正面=提示或中文释义/场景，反面=英文+你造的例句+易错提醒”；完成≥10张。\n3) 快速复习（10分钟）：复习到期卡；错题立即编辑备注并调高出现频率。",
        done: "合格标准：\n- 新增卡片≥10；\n- 到期卡全部复习；\n- 每类至少1张“功能句卡”。",
        review: "为新增卡设置：D+1/D+3/D+7/D+14/D+28；在Notion中记录“本周Top5高价值卡”。"
      }),
      reading: (d) => ({
        title: "快速阅读与摘要（职场语料）",
        resources: [
          `<a href="${pick(curated.readingTech, d, getOffset(d, 'reading')).url}" target="_blank" rel="noopener">${pick(curated.readingTech, d, getOffset(d, 'reading')).name}</a>`,
          '<a href="https://pomofocus.io/" target="_blank" rel="noopener">Pomodoro Timer</a>'
        ],
        method: "分步执行（共60分钟）\n1) 扫读（5分钟）：看题图/标题/小结，判断主题与产出类型。\n2) 精读（20分钟）：逐段抓“问题/方案/指标/结果”句；把“KPI句”复制到笔记。\n3) 摘要（15分钟）：写5点英文摘要（每点≤15词，覆盖KPI句）。\n4) 术语与表达（10分钟）：记录5个高频表达并写你自己的例句。\n5) 复述（10分钟）：口述60秒总结→录音保存。",
        done: "合格标准：\n- 5点英文摘要完整；\n- 5个高频表达附你自己的例句；\n- 60秒复述录音1段。",
        review: "当日：把2个表达做成SRS“术语卡”。\nD+3：同主题换一篇做摘要对比；D+7：把两篇摘要合并为一段100词通俗解释。"
      }),
      dinner: () => ({ title: "晚餐休息", resources: [], method: "放松恢复：\n- 10–20分钟散步；\n- 3分钟闭眼呼吸；\n- 睡前2小时内不再摄入高糖/高咖啡因。", done: "完成走动或拉伸，并远离屏幕≥15分钟。", review: "晚间开始学习前，口头回忆今天3个关键词（不看笔记）。" }),
      simulation: (d) => ({
        title: "项目模拟（SOW/Acceptance/里程碑）",
        resources: ['<a href="https://www.notion.so/" target="_blank" rel="noopener">Notion SOW模板</a>', '<a href="https://www.smartsheet.com/how-to-write-statement-of-work" target="_blank" rel="noopener">SOW写法指南（Smartsheet）</a>', (fixedMap.businessListening[d-1] ? `<a href="${fixedMap.businessListening[d-1].url}" target="_blank" rel="noopener">${fixedMap.businessListening[d-1].name}</a>` : `<a href="${pick(curated.businessListening, d-1, getOffset(d, 'simulation')).url}" target="_blank" rel="noopener">${pick(curated.businessListening, d-1, getOffset(d, 'simulation')).name}</a>`)],
        method: "分步执行（共60分钟）\n1) 选题（5分钟）：取今日职位帖或你现有Demo作为项目。\n2) 范围（15分钟）：写“in scope/out of scope”各3条；明确排除项。\n3) 里程碑（15分钟）：分解为2–3个milestones，每个写“交付物+时间”。\n4) 验收（10分钟）：每个里程碑写1–2条可执行验收动作（如“用户能完成X并通过Y指标”）。\n5) 风险与假设（10分钟）：列3条风险+3条假设；写缓解或前置条件。\n6) 展示（5分钟）：复制到Notion模板，保留链接用于提案/纪要。",
        done: "合格标准：\n- SOW一页齐全（范围/里程碑/验收/风险/假设）；\n- 验收动作可执行且可量化；\n- 保存在Notion并可分享链接。",
        review: "当日：抽取3个通用表达做SRS（如out of scope/change request）。\nD+3：将一个里程碑拆得更细；D+7：把SOW转化为Upwork提案中的“计划与验收”段落。"
      }),
      mockCall: (d) => ({
        title: "15分钟模拟通话（脚本→演练）",
        resources: ['<a href="https://support.google.com/meet/answer/9302870?hl=en" target="_blank" rel="noopener">Google Meet</a>', '<a href="https://zoom.us/" target="_blank" rel="noopener">Zoom</a>', `<a href="${pick(curated.negotiationCrossCulture, d-1, getOffset(d, 'mockCall')).url}" target="_blank" rel="noopener">${pick(curated.negotiationCrossCulture, d-1, getOffset(d, 'mockCall')).name}</a>`],
        method: "分步执行（共60分钟）\n1) 脚本（10分钟）：写15分钟议程：开场寒暄→目标→痛点复述→方案/里程碑→风险/假设→下一步。\n2) 演练1（10分钟）：按脚本走一遍，注意“复述+确认”。\n3) 录制（15分钟）：录2次，第二次尽量更自然。\n4) 回放评估（10分钟）：统计填充词（um/uh/you know），目标<5次；记录三处需改进的表达。\n5) 演练2（10分钟）：修正后再演练一次。\n6) 记录沉淀（5分钟）：把“最佳复述句/确认句/收尾CTA”加入模板库。",
        done: "合格标准：\n- 录音≥1段（10–15分钟）；\n- 填充词≤5次；\n- 复述+确认句各≥2句落地；\n- 模板库新增≥3句可复用表达。",
        review: "当日：把2句复述句与1句CTA做成SRS功能句。\nD+1：换项目复述同样结构；D+7：与朋友/同事进行一次双人演练。"
      }),
      dayReview: (d) => ({
        title: "日复盘与明日计划",
        resources: ["KPI看板（Notion）", "进度导出JSON"],
        method: "分步执行（共30分钟）\n1) 产出清点（8分钟）：检查今日录音/文档/卡片是否齐全且命名规范。\n2) 困难与对策（8分钟）：写3条困难+对应改进措施。\n3) 明日计划（6分钟）：在页面勾选明日要优先的3个时段目标。\n4) 导出（8分钟）：点击“今日导出（MD/JSON）”→复制Markdown→粘贴到Notion“英语打卡数据库”。",
        done: "合格标准：\n- Notion已新增“Day N”日志并含链接与清单；\n- 列出3条困难与对策；\n- 明日3个优先时段已标记。",
        review: "每周末：导出一周7个Markdown，合并为复盘页，评估：口语分钟数/写作篇数/SRS新增卡/完成率。"
      })
    };

    // Time layout per day (fixed blocks with lunch/dinner breaks)
    const timeLayout = [
      { time: "08:30–09:00", key: "srsMorning" },
      { time: "09:00–10:30", key: "dialysis" },
      { time: "10:30–11:30", key: "grammar" },
      { time: "11:30–12:00", key: "listening" },
      { time: "12:00–13:30", key: "lunch", isBreak: true },
      { time: "13:30–14:30", key: "elsa" },
      { time: "14:30–15:30", key: "feynman" },
      { time: "15:30–16:30", key: "writing" },
      { time: "16:30–17:00", key: "srsAfternoon" },
      { time: "17:00–18:00", key: "reading" },
      { time: "18:00–19:30", key: "dinner", isBreak: true },
      { time: "19:30–20:30", key: "simulation" },
      { time: "20:30–21:30", key: "mockCall" },
      { time: "21:30–22:00", key: "dayReview" }
    ];

    // Week themes
    const weekTheme = (d) => {
      if (d <= 7) return "第1周：框架搭建（规则/方法/模板）";
      if (d <= 14) return "第2周：强输出（写作/讲解/小型实战）";
      if (d <= 21) return "第3周：实战模拟（提案/纪要/Mock Call）";
      return "第4周：巩固上麦（稳定表达与自信）";
    };

    // Storage helpers
    const storageKey = (d, slotKey) => `eb28:${d}:${slotKey}`;
    const saveCheck = (d, slotKey, checked) => {
      localStorage.setItem(storageKey(d, slotKey), checked ? "1" : "0");
    };
    const loadCheck = (d, slotKey) => localStorage.getItem(storageKey(d, slotKey)) === "1";
    const clearAllChecks = () => {
      Object.keys(localStorage).forEach(k => { if (k.startsWith("eb28:")) localStorage.removeItem(k); });
      document.querySelectorAll('input[type="checkbox"][data-slot]').forEach(cb => cb.checked = false);
    };
    const exportProgress = () => {
      const out = {};
      Object.keys(localStorage).forEach(k => { if (k.startsWith("eb28:")) out[k] = localStorage.getItem(k); });
      const blob = new Blob([JSON.stringify(out, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'english-bootcamp-28d-progress.json';
      a.click();
      URL.revokeObjectURL(a.href);
    };

    function createDayElement(day) {
      const dayDiv = document.createElement('div');
      dayDiv.className = 'day';
      dayDiv.id = `day-${day}`;

      const head = document.createElement('div');
      head.className = 'day-head';
      const title = document.createElement('div');
      title.className = 'day-title';
      title.textContent = `第 ${day} 天`;
      const sub = document.createElement('div');
      sub.className = 'day-sub';
      sub.textContent = weekTheme(day);
      const left = document.createElement('div');
      left.appendChild(title);
      left.appendChild(sub);

      const actions = document.createElement('div');
      actions.className = 'day-actions';
      const btnToggle = document.createElement('button');
      btnToggle.className = 'btn';
      btnToggle.textContent = '展开/折叠';
      btnToggle.addEventListener('click', () => dayDiv.classList.toggle('open'));

      const btnAll = document.createElement('button');
      btnAll.className = 'btn';
      btnAll.textContent = '全选/全不选';
      btnAll.addEventListener('click', () => {
        const cbs = dayDiv.querySelectorAll('input[type="checkbox"][data-slot]');
        const allChecked = Array.from(cbs).every(cb => cb.checked);
        cbs.forEach(cb => { cb.checked = !allChecked; cb.dispatchEvent(new Event('change')); });
      });

      actions.appendChild(btnToggle);
      actions.appendChild(btnAll);

      const leftWrap = document.createElement('div');
      leftWrap.style.display = 'flex';
      leftWrap.style.flexDirection = 'column';
      head.appendChild(leftWrap);
      head.firstChild.replaceWith(left);
      head.appendChild(actions);

      const body = document.createElement('div');
      body.className = 'day-body';
      const table = document.createElement('table');
      table.className = 'table';

      const thead = document.createElement('thead');
      thead.innerHTML = `
        <tr>
          <th style="width:110px">时间</th>
          <th style="width:220px">任务</th>
          <th>参考资料</th>
          <th>学习方法</th>
          <th>完成标准</th>
          <th>复习策略</th>
          <th style="width:70px">完成</th>
        </tr>`;

      const tbody = document.createElement('tbody');
      timeLayout.forEach(slot => {
        const tr = document.createElement('tr');
        const tdTime = document.createElement('td'); tdTime.className = 'time'; tdTime.textContent = slot.time; tr.appendChild(tdTime);

        const details = slotTemplates[slot.key](day);
        const tdTitle = document.createElement('td');
        tdTitle.innerHTML = slot.isBreak ? `<span class="break">${details.title}</span>` : `<span class="task-title">${details.title}</span>`;
        tr.appendChild(tdTitle);

        const tdRes = document.createElement('td');
        tdRes.className = 'res';
        tdRes.innerHTML = details.resources.length ? `<ul>${details.resources.map(r => `<li>${r}</li>`).join('')}</ul>` : '—';
        tr.appendChild(tdRes);

        const tdMethod = document.createElement('td');
        tdMethod.className = 'method';
        tdMethod.textContent = details.method;
        tr.appendChild(tdMethod);

        const tdDone = document.createElement('td');
        tdDone.className = 'done';
        tdDone.textContent = details.done;
        tr.appendChild(tdDone);

        const tdReview = document.createElement('td');
        tdReview.className = 'review';
        tdReview.textContent = details.review;
        tr.appendChild(tdReview);

        const tdCheck = document.createElement('td');
        tdCheck.style.textAlign = 'center';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.className = 'checkbox';
        cb.dataset.slot = slot.key;
        cb.checked = loadCheck(day, slot.key);
        cb.addEventListener('change', () => saveCheck(day, slot.key, cb.checked));
        tdCheck.appendChild(cb);
        tr.appendChild(tdCheck);

        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      body.appendChild(table);

      dayDiv.appendChild(head);
      dayDiv.appendChild(body);
      return dayDiv;
    }

    function renderDays() {
      const wrap = document.getElementById('days');
      for (let d = 1; d <= 28; d++) {
        const el = createDayElement(d);
        if (d === 1) el.classList.add('open');
        wrap.appendChild(el);
      }
    }

    // Actions
    document.getElementById('expandAll').addEventListener('click', () => {
      document.querySelectorAll('.day').forEach(d => d.classList.add('open'));
    });
    document.getElementById('collapseAll').addEventListener('click', () => {
      document.querySelectorAll('.day').forEach(d => d.classList.remove('open'));
    });
    document.getElementById('clearChecks').addEventListener('click', () => {
      if (confirm('确认清除所有勾选进度？')) clearAllChecks();
    });
    document.getElementById('exportProgress').addEventListener('click', exportProgress);
    document.getElementById('printPlan').addEventListener('click', () => window.print());
    // Export Today modal
    const expModal = document.getElementById('expModal');
    const expBackdrop = document.getElementById('expBackdrop');
    const openExport = document.getElementById('openExport');
    const closeExport = document.getElementById('closeExport');
    const exportMD = document.getElementById('export-md');
    const exportJSON = document.getElementById('export-json');
    const copyMD = document.getElementById('copyMD');
    const copyJSON = document.getElementById('copyJSON');
    function openExp() {
      const todayHash = new URL(location.href).hash;
      const dayNum = todayHash && todayHash.startsWith('#d') ? parseInt(todayHash.replace('#d',''), 10) : 1;
      const dayEl = document.getElementById(`day-${dayNum}`) || document.getElementById('day-1');
      if (dayEl) dayEl.classList.add('open');
      const entries = [];
      dayEl.querySelectorAll('tbody tr').forEach(tr => {
        const time = tr.querySelector('.time')?.textContent?.trim() || '';
        const task = tr.querySelector('.task-title, .break')?.textContent?.trim() || '';
        const resLinks = Array.from(tr.querySelectorAll('.res a')).map(a => ({ text: a.textContent.trim(), url: a.href }));
        const method = tr.querySelector('.method')?.textContent?.trim() || '';
        const done = tr.querySelector('.done')?.textContent?.trim() || '';
        const review = tr.querySelector('.review')?.textContent?.trim() || '';
        const checked = tr.querySelector('input[type="checkbox"][data-slot]')?.checked || false;
        if (time) entries.push({ time, task, resources: resLinks, method, done, review, checked });
      });
      const md = [
        `# Day ${dayNum} — Study Log`,
        '',
        entries.map(e => {
          const links = e.resources.map(r => `- [${r.text}](${r.url})`).join('\n');
          return [
            `## ${e.time} · ${e.task} ${e.checked ? '✅' : '⬜️'}`,
            links,
            '',
            `- Method: ${e.method}`,
            `- Completion: ${e.done}`,
            `- Review: ${e.review}`,
          ].join('\n');
        }).join('\n\n')
      ].join('\n');
      exportMD.textContent = md;
      exportJSON.textContent = JSON.stringify({ day: dayNum, entries }, null, 2);
      expModal.classList.add('open');
      expBackdrop.classList.add('open');
    }
    function closeExp() { expModal.classList.remove('open'); expBackdrop.classList.remove('open'); }
    openExport.addEventListener('click', openExp);
    closeExport.addEventListener('click', closeExp);
    expBackdrop.addEventListener('click', closeExp);
    copyMD.addEventListener('click', () => navigator.clipboard.writeText(exportMD.textContent).then(() => { copyMD.textContent = '已复制'; setTimeout(() => copyMD.textContent = '复制Markdown', 1200); }));
    copyJSON.addEventListener('click', () => navigator.clipboard.writeText(exportJSON.textContent).then(() => { copyJSON.textContent = '已复制'; setTimeout(() => copyJSON.textContent = '复制JSON', 1200); }));
    // Templates modal
    const tplModal = document.getElementById('tplModal');
    const tplBackdrop = document.getElementById('tplBackdrop');
    const openTpl = document.getElementById('openTemplates');
    const closeTpl = document.getElementById('closeTemplates');
    function openTemplates() { tplModal.classList.add('open'); tplBackdrop.classList.add('open'); }
    function closeTemplates() { tplModal.classList.remove('open'); tplBackdrop.classList.remove('open'); }
    openTpl.addEventListener('click', openTemplates);
    closeTpl.addEventListener('click', closeTemplates);
    tplBackdrop.addEventListener('click', closeTemplates);
    document.querySelectorAll('[data-copy]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-copy');
        const pre = document.getElementById(id);
        if (!pre) return;
        navigator.clipboard.writeText(pre.textContent).then(() => {
          btn.textContent = '已复制';
          setTimeout(() => btn.textContent = '复制', 1200);
        });
      });
    });
    document.getElementById('jumpTop').addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    document.getElementById('jumpToday').addEventListener('click', () => {
      const todayHash = new URL(location.href).hash;
      const dayNum = todayHash && todayHash.startsWith('#d') ? parseInt(todayHash.replace('#d',''), 10) : 1;
      const el = document.getElementById(`day-${dayNum}`) || document.getElementById('day-1');
      el.classList.add('open');
      el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    renderDays();
  </script>
</body>
</html>



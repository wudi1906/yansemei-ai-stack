# Private AI Lab - 项目开发指南

> 此文档记录项目的核心架构决策和开发规范，所有后续开发必须遵循这些原则。

---

## 一、核心架构认知

### 1.1 数据共享架构（已验证）

```
所有服务共享同一个 RAG Core (9621) 知识库：

Admin UI (5173) ──┐
                  ├──► RAG Core (9621) ◄──┬── MCP Server (8001)
Chat UI (3000) ───┘                       │
                                          └── Agent Service (2025)
```

**关键配置**：
- `chat-ui/.env` → `NEXT_PUBLIC_RAG_CORE_URL=http://localhost:9621`
- `admin-ui/.env.development` → `VITE_BACKEND_URL=http://localhost:9621`
- `mcp-server` → `RAG_CORE_API_URL=http://127.0.0.1:9621`

### 1.2 服务端口规范

| 服务 | 端口 | 职责 |
|------|------|------|
| RAG Core | 9621 | 知识库引擎（核心） |
| MCP Server | 8001 | 工具接口层 |
| Agent Service | 2025 | AI代理（LangGraph） |
| Chat UI | 3000 | 用户对话界面 |
| Admin UI | 5173 | 管理控制台 |

---

## 二、模块化交付策略

### 2.1 模块组合方案

```
场景A: 纯知识库管理
├── RAG Core (9621)
└── Admin UI (5173)

场景B: 智能问答系统
├── RAG Core (9621)
├── MCP Server (8001)
├── Agent Service (2025)
└── Chat UI (3000)

场景C: 完整企业方案
├── 全部5个服务

场景D: API集成（给客户现有系统）
├── RAG Core (9621)
└── MCP Server (8001)
```

### 2.2 客户交付流程

1. 分析需求 → 确定需要哪些模块
2. 创建客户分支 → `git checkout -b customer/xxx`
3. 配置环境 → 修改 `.env` 文件
4. 定制开发 → 仅修改必要部分
5. Docker打包 → 一键部署

### 2.3 Docker交付优势

- 环境一致性：开发=测试=生产
- 一键部署：`docker-compose up -d`
- 隔离安全：不污染客户系统
- 版本管理：镜像标签轻松回滚

---

## 三、场景测试规范

### 3.1 测试场景来源

所有测试场景定义在 `项目功能与场景分析.md`，包括：
1. 企业知识库问答
2. 合同/法律文档分析
3. 技术文档智能问答
4. 多模态文档理解
5. 实时对话+知识库混合
6. 知识图谱可视化分析

### 3.2 测试原则

- 每个场景必须覆盖完整数据流
- Admin UI 上传 → Chat UI 查询 必须验证数据共享
- 记录测试结果和发现的问题

---

## 四、开发提醒

### ⚠️ 重要提醒（Kiro必须遵守）

1. **不要随意修改代码**：先分析、先讨论、再动手
2. **场景优先**：所有开发围绕 `项目功能与场景分析.md` 中的场景
3. **模块化思维**：保持各模块独立性，通过API通信
4. **Docker交付**：最终交付形式是Docker镜像
5. **数据共享**：所有服务连接同一个RAG Core

### 📋 待办事项

- [ ] 逐个测试6个场景
- [ ] 完善Docker多服务配置
- [ ] 创建客户交付模板
- [ ] 编写模块API文档

---

*创建时间: 2025-12-08*
*AuroraAI Private AI Lab*
